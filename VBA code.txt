Public Unlocked As Boolean

Sub HideSheets()
'https://www.mrexcel.com/forum/excel-questions/8050-macro-hide-all-sheets-except-one.html

Dim sht As Object

For Each sht In Sheets
If sht.Name <> "Accueil" Then
sht.Visible = xlSheetVeryHidden
End If
Next sht

End Sub

Sub UnhideSheets(Scope As String)
Dim i As Integer
Dim SheetArray As Variant
Dim ShtNames() As String
ReDim ShtNames(1 To ActiveWorkbook.Sheets.Count)

Select Case Scope
    Case "Consommation"
        SheetArray = Sheets("VBA").ListObjects("ConsommationSheets").DataBodyRange.Value
        If IsArray(SheetArray) Then
            For i = LBound(SheetArray, 1) To UBound(SheetArray, 1)
            Sheets(SheetArray(i, 1)).Visible = True
            Next i
        Else
            Sheets(Sheets("VBA").ListObjects("ConsommationSheets").DataBodyRange.Value).Visible = True
        End If
        
    Case "Finances"
        SheetArray = Sheets("VBA").ListObjects("FinancesSheets").DataBodyRange.Value
        If IsArray(SheetArray) Then
            For i = LBound(SheetArray, 1) To UBound(SheetArray, 1)
            Sheets(SheetArray(i, 1)).Visible = True
            Next i
        Else
            Sheets(Sheets("VBA").ListObjects("FinancesSheets").DataBodyRange.Value).Visible = True
        End If
        
    Case "All"
        For i = 1 To Sheets.Count
            Sheets(i).Visible = True
        Next i
    End Select

End Sub

'Source: https://answers.microsoft.com/en-us/office/forum/office_2010-excel/how-to-password-protect-a-single-tab-in-a-workbook/934ceaeb-a6e8-400b-8123-0e2d393ff94b

Private Sub Workbook_SheetActivate(ByVal Sh As Object)
''Dim MySheets As String, Response As String

'Source: https://stackoverflow.com/questions/37689847/creating-an-array-from-a-range-in-vba
''Dim SheetArray As Variant
''SheetArray = Sheets("VBA").ListObjects("ProtectSheets").DataBodyRange.Value
'Source: https://stackoverflow.com/questions/12642164/check-if-value-exists-in-column-in-vba
''If Not IsError(Application.Match(ActiveSheet.Name, SheetArray, 0)) And Unlocked = False Then
''ActiveSheet.Visible = False
''    Response = InputBox("Enter password to view sheet")
''        If Response = "MyPass" Then
''            UnhideSheets
''            Unlocked = True
''        End If
''End If
''UnhideSheets
End Sub

Private Sub Workbook_Open()
HideSheets
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
HideSheets
End Sub

Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
HideSheets
End Sub

Private Sub Workbook_AfterSave(ByVal Success As Boolean)
Dim actsht As Object
Dim actrange As Object

actsht = ActiveSheet
actrange = Selection

If Unlocked = True Then
    UnhideSheets ("All")
    ActiveSheet = actsht
    Selection = actrange
End If
End Sub


Sub Consommation_Click()

UnhideSheets ("Consommation")

End Sub

Sub Finances_Click()

UnhideSheets ("Finances")

End Sub

Sub VueGlobal_Click()
Dim Response As String

Response = InputBox("Enter password to view all sheets.")
If Response = "MyPass" Then
    UnhideSheets ("All")
    Unlocked = True
End If

End Sub

Modules:


Public Function ModDate()
ModDate = Format(FileDateTime(ThisWorkbook.FullName), "d mmm yyyy - h:n")
End Function

'Source: https://www.extendoffice.com/documents/excel/949-excel-last-modified-user-name.html
Public Function LastAuthor()
LastAuthor = ActiveWorkbook.BuiltinDocumentProperties("Last Author")
End Function
